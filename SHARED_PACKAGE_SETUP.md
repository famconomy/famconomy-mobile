# FamConomy Shared Package Setup Guide

## Overview

We've successfully created a centralized **`@famconomy/shared`** package that contains all common types, API clients, and utilities used across the web, API, and mobile applications.

## What's Been Created

### Package Structure
```
packages/shared/
├── package.json         # Dependencies and build scripts
├── tsconfig.json        # TypeScript configuration
├── src/
│   ├── index.ts         # Main export file
│   ├── types/
│   │   └── index.ts     # All shared type definitions
│   └── clients/
│       ├── apiClient.ts     # Base API client
│       ├── tasks.ts         # Task endpoints
│       ├── family.ts        # Family endpoints
│       ├── screenTime.ts    # Screen time endpoints
│       └── messages.ts      # Message endpoints
└── dist/                # Compiled output (generated by npm run build)
```

## Shared Types Exported

### Core Domain Types
- **User**: User information with role and status
- **Family**: Family data with members and settings
- **Task**: Tasks with status tracking and attachments
- **ScreenTime**: Screen time tracking data
- **Gig**: Gig/reward opportunities
- **Room**: Room data for chores/gigs
- **Message & Chat**: Communication types
- **ShoppingList & ShoppingListItem**: Shopping list management
- **Recipe & Meal**: Recipe and meal planning
- **Wishlist & WishlistItem**: User wishlists
- **Guidelines**: Family guidelines
- **Budget**: Budget tracking
- **SavingsGoal**: Savings goal types

### Enum Types
- **UserRole**: 'admin' | 'parent' | 'child' | 'guardian'
- **UserStatus**: 'active' | 'inactive' | 'pending'
- **TaskStatus**: 'pending' | 'assigned' | 'in_progress' | 'completed' | 'approved'

## API Clients Exported

### Available Clients

#### `taskClient`
```typescript
import { taskClient } from '@famconomy/shared';

await taskClient.getAll(familyId);
await taskClient.getById(taskId);
await taskClient.create(taskData);
await taskClient.update(taskId, taskData);
await taskClient.updateStatus(taskId, status);
await taskClient.delete(taskId);
await taskClient.approve(taskId, approvalStatusId);
await taskClient.uploadAttachment(taskId, file);
await taskClient.deleteAttachment(taskId, attachmentId);
```

#### `familyClient`
```typescript
import { familyClient } from '@famconomy/shared';

await familyClient.get(familyId);
await familyClient.create(data);
await familyClient.update(familyId, data);
await familyClient.getMembers(familyId);
await familyClient.addMember(familyId, userId, role);
await familyClient.removeMember(familyId, userId);
await familyClient.getInvites(familyId);
await familyClient.sendInvite(familyId, email, role);
await familyClient.acceptInvite(inviteId);
await familyClient.declineInvite(inviteId);
```

#### `screenTimeClient`
```typescript
import { screenTimeClient } from '@famconomy/shared';

await screenTimeClient.getAll(familyId, userId);
await screenTimeClient.getByUser(userId);
await screenTimeClient.create(data);
await screenTimeClient.delete(screenTimeId);
```

#### `messageClient`
```typescript
import { messageClient } from '@famconomy/shared';

await messageClient.getChats(familyId);
await messageClient.getChat(chatId);
await messageClient.getMessages(chatId, limit, offset);
await messageClient.sendMessage(chatId, content, type);
await messageClient.deleteMessage(messageId);
await messageClient.markAsRead(messageId);
```

## Workspace Path Aliases

The monorepo is configured to use `@famconomy/shared` as a workspace alias. This works in:

### TypeScript Configuration
Added to `tsconfig.base.json`:
```json
{
  "compilerOptions": {
    "paths": {
      "@famconomy/shared": ["packages/shared/src"],
      "@famconomy/shared/*": ["packages/shared/src/*"]
    }
  }
}
```

### Vite Configuration
Updated `apps/web/vite.config.ts` with:
```typescript
resolve: {
  alias: {
    '@famconomy/shared': path.resolve(__dirname, '../../packages/shared/src'),
  },
}
```

## Usage in Web App

### Importing Types
```typescript
import { Task, TaskStatus, User, Family } from '@famconomy/shared';
```

### Importing API Clients
```typescript
import { taskClient, familyClient } from '@famconomy/shared';

// Use in components or hooks
const tasks = await taskClient.getAll(familyId);
```

### Updated Web App Files
- `apps/web/src/api/tasks.ts` - Now uses `taskClient` from shared
- `apps/web/tsconfig.app.json` - Extended base config with path aliases
- `apps/web/vite.config.ts` - Added module resolution alias

## Building & Development

### Build the shared package
```bash
cd packages/shared
npm run build
```

### Watch mode for development
```bash
cd packages/shared
npm run dev
```

### Build all packages
```bash
npm run nx build shared  # If using Nx
npm run build           # From root
```

## Next Steps for Migration

1. **Update API clients in web app**:
   - Replace direct axios calls with shared clients
   - Update `apps/web/src/api/*.ts` files

2. **Migrate remaining types**:
   - Move domain-specific types from `apps/web/src/types/*.ts`
   - Add budget, recipe, wishlist clients

3. **Update API app**:
   - Install and use shared types in `apps/api/src/types`
   - Ensure type consistency between frontend and backend

4. **Setup mobile app**:
   - Configure React Native to use shared package
   - Update mobile's tsconfig and module resolution

5. **Add more clients**:
   - Budget client
   - Recipe client
   - Gig client
   - Shopping list client
   - Wishlist client

## Files Modified

### Created
- ✅ `packages/shared/package.json`
- ✅ `packages/shared/tsconfig.json`
- ✅ `packages/shared/src/index.ts`
- ✅ `packages/shared/src/types/index.ts`
- ✅ `packages/shared/src/clients/apiClient.ts`
- ✅ `packages/shared/src/clients/tasks.ts`
- ✅ `packages/shared/src/clients/family.ts`
- ✅ `packages/shared/src/clients/screenTime.ts`
- ✅ `packages/shared/src/clients/messages.ts`

### Modified
- ✅ `tsconfig.base.json` - Added path mappings
- ✅ `apps/web/tsconfig.app.json` - Extended base, added baseUrl
- ✅ `apps/web/vite.config.ts` - Added module resolution alias
- ✅ `apps/web/src/api/tasks.ts` - Updated to use shared taskClient

## Troubleshooting

### Module not found errors
Make sure to run `npm install` in the root directory after creating new files.

### TypeScript errors about shared package
Build the shared package with `npm run build` inside the `packages/shared` directory.

### Path alias not resolving in IDE
Restart TypeScript server (Cmd+Shift+P → "TypeScript: Restart TS Server" in VS Code).

### Vite not recognizing the alias
Clear `.vite` cache and node_modules, then reinstall: `rm -rf node_modules .vite && npm install`
